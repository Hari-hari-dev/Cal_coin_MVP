<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phantom + Solana Web3.js Demo</title>
  <!-- Only the Solana Web3 library (no Anchor) -->
  <script src="https://unpkg.com/@solana/web3.js@1.84.1/lib/index.iife.js"></script>
</head>
<body>
  <h1>Phantom + Solana Web3.js (Vanilla JS) v1</h1>
  
  <!-- Buttons for demonstration -->
  <button id="connectBtn">Connect Phantom</button>
  <button id="airdropBtn">Airdrop 0.1 SOL</button>
  <button id="balanceBtn">Check Balance</button>

  <div id="status" style="margin-top: 1em; white-space: pre-wrap;"></div>

  <script>
    // We'll store the connection and the userPublicKey once we connect Phantom
    let connection;
    let userPublicKey;

    /*********************************************************
     * 1) Connect to Phantom
     *********************************************************/
    async function connectPhantom() {
      if (!window.solana) {
        alert("Phantom wallet not found. Please install or enable it!");
        return;
      }
      try {
        // Request connection (Phantom's standard approach)
        await window.solana.connect();
        // The connected wallet's public key
        userPublicKey = window.solana.publicKey;
        console.log("Connected to Phantom as:", userPublicKey.toBase58());
        document.getElementById('status').textContent = 
          `Connected to Phantom: ${userPublicKey.toBase58()}`;
      } catch (err) {
        console.error("Phantom connect error:", err);
        document.getElementById('status').textContent = 
          `Failed to connect Phantom: ${err.message}`;
      }
    }

    /*********************************************************
     * 2) Setup Solana Connection
     *********************************************************/
    // We'll create a connection to devnet once we load the page
    window.addEventListener('load', () => {
      // Using devnet
      connection = new solanaWeb3.Connection(
        solanaWeb3.clusterApiUrl('devnet'),
        'confirmed'
      );
      console.log("Solana devnet connection set up.");
    });

    /*********************************************************
     * 3) Airdrop 0.1 SOL to the Connected Wallet
     *********************************************************/
    async function onAirdrop() {
      if (!userPublicKey) {
        alert("Please connect Phantom first!");
        return;
      }
      try {
        // Request airdrop of 0.1 SOL
        const lamports = 0.1 * solanaWeb3.LAMPORTS_PER_SOL;
        const airdropSig = await connection.requestAirdrop(
          userPublicKey,
          lamports
        );
        // Confirm the transaction
        const latestBlockhash = await connection.getLatestBlockhash();
        await connection.confirmTransaction({
          signature: airdropSig,
          ...latestBlockhash,
        });

        document.getElementById('status').textContent = 
          `Airdrop of 0.1 SOL successful!\nTx Signature: ${airdropSig}`;
        console.log("Airdrop signature:", airdropSig);
      } catch (err) {
        console.error("Airdrop error:", err);
        document.getElementById('status').textContent =
          `Airdrop failed: ${err.message}`;
      }
    }

    /*********************************************************
     * 4) Check Balance
     *********************************************************/
    async function onCheckBalance() {
      if (!userPublicKey) {
        alert("Please connect Phantom first!");
        return;
      }
      try {
        const balanceLamports = await connection.getBalance(userPublicKey);
        const balanceSol = balanceLamports / solanaWeb3.LAMPORTS_PER_SOL;
        document.getElementById('status').textContent =
          `Wallet Balance: ${balanceSol.toFixed(4)} SOL`;
      } catch (err) {
        console.error("Balance error:", err);
        document.getElementById('status').textContent =
          `Balance check failed: ${err.message}`;
      }
    }

    // Wire up the buttons
    document.getElementById('connectBtn').onclick = connectPhantom;
    document.getElementById('airdropBtn').onclick = onAirdrop;
    document.getElementById('balanceBtn').onclick = onCheckBalance;
  </script>
</body>
</html>
