<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anchor 0.26.0 Example</title>

  <!-- Load Solana Web3.js for Phantom usage -->
  <script src="https://unpkg.com/@solana/web3.js@1.84.1/lib/index.iife.js"></script>

  <!-- Load Buffer polyfill -->
  <script src="https://cdn.jsdelivr.net/npm/buffer@5.2.1/dist/buffer.min.js"></script>

  <!-- Load Anchor 0.26.0 Browser Build -->
  <script src="https://unpkg.com/@coral-xyz/anchor@0.29.0/dist/browser/index.js"></script>

  <script>
    // Check if 'anchor' is defined
    if (typeof anchor === 'undefined') {
      console.error("anchor is undefined even after loading anchor@0.26.0 script.");
    } else {
      console.log("anchor is defined. Version info:", anchor);
    }

    // Phantom wallet connection setup
    let userPublicKey;

    async function connectPhantom() {
      if (!window.solana) {
        alert("Phantom wallet not found. Please install/enable it!");
        return;
      }
      try {
        await window.solana.connect();
        userPublicKey = window.solana.publicKey;
        document.getElementById("status").textContent =
          "Phantom connected: " + userPublicKey.toBase58();
      } catch (err) {
        console.error("Connect error:", err);
        document.getElementById("status").textContent =
          "Connect error: " + err.message;
      }
    }

    // Test using Anchor
    async function testAnchor() {
      if (!userPublicKey) {
        alert("Please connect Phantom first!");
        return;
      }
      try {
        // Confirm 'anchor' is loaded
        if (typeof anchor === 'undefined') {
          throw new Error("anchor is still undefined.");
        }

        // Create a minimal provider
        const connection = new solanaWeb3.Connection("https://api.devnet.solana.com", "confirmed");
        const wallet = {
          publicKey: userPublicKey,
          signTransaction: (tx) => window.solana.signTransaction(tx),
          signAllTransactions: (txs) => window.solana.signAllTransactions(txs)
        };
        const provider = new anchor.AnchorProvider(connection, wallet, {
          preflightCommitment: "confirmed",
        });

        document.getElementById("status").textContent =
          "Anchor loaded and provider created!\nPublicKey: " + userPublicKey.toBase58();
        console.log("Provider:", provider);
      } catch (err) {
        console.error("Test anchor error:", err);
        document.getElementById("status").textContent =
          "Test anchor error: " + err.message;
      }
    }

    // Event listeners for buttons
    document.getElementById("connectBtn").onclick = connectPhantom;
    document.getElementById("testBtn").onclick = testAnchor;
  </script>
</head>
<body>
  <h1>Anchor 0.26.0 Example</h1>

  <!-- Buttons -->
  <button id="connectBtn">Connect Phantom</button>
  <button id="testBtn">Test Anchor</button>

  <!-- Status display -->
  <pre id="status"></pre>
</body>
</html>
